{% extends 'base.html' %}
{% load static %}

{% block title %}Home{% endblock title %}

{% block homeactive %}active{% endblock homeactive %}

{% block style %}
<link rel="stylesheet" href="{% static 'main/style.css' %}">
{% endblock style %}



{% block body %}


<!-- Main Timer -->
<div class="container px-5 d-flex justify-content-center align-items-center flex-column"
  style="height: calc(100vh - 60px);">

  <form action="/" method="post" name="getrange">
    {% csrf_token %}
    <input type="range" value=1 onclick="checkr()" onchange="checkr()" id="range" style="width: 300px !important;"
      name="range" class="form-range" width="200px" min="1" max="6">
    <input type="hidden" name="hidden" id="hidden" value=0>
  </form>


  <div>
    <div class="text-center text-warning my-2 h6" id="treesinfo">Plants 1 tree if you fail, you kill a tree</div>
    <div class="text-center text-warning my-2 h6" id="coinsinfo">
      <div>Success: +25 coins</div>
      <div>Failure: -20 coins</div>
    </div>
  </div>

  <div class="d-flex justify-content-center align-items-center my-3" id="timer">
    {% if loginuser.in_session %}
    <div class="spinner-border text-warning" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    {% else %}
    <h4 id="minutes" class="display-4 text-warning">30</h4>
    <h4 id="separator" class="display-4 text-warning">:</h4>
    <h4 id="seconds" class="display-4 text-warning">00</h4>
    {% endif %}
  </div>

  <strong class="text-warning text-center h6">Deep Focus Mode Will be Back Soon</strong>

  {% if loginuser %}
  <button class="btn btn-warning mt-3" id="startbtn" onclick="document.getrange.submit()">
    start
  </button>
  <button class="btn btn-warning d-none mt-3" data-bs-toggle="modal" data-bs-target="#diedtreemodal" id="giveupbtn">
    Giveup
  </button>
  <button class="btn btn-secondary d-none mt-3" onclick="canceltimer()" id="cancelbtn">
    Cancel
  </button>
  {% else %}
  <strong>Please Login to continue</strong>
  {% endif %}
</div>



<!-- Modal -->
<div class="modal fade" id="diedtreemodal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
  aria-labelledby="diedtreemodalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="diedtreemodalLabel">Your Tree(s) Will Die</h5>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-success" onclick="giveup()">Ok</button>
      </div>
    </div>
  </div>
</div>




<button class="btn btn-warning d-none mt-2" data-bs-toggle="modal" data-bs-target="#treemodal" id="treemodalbtn">
</button>
<div class="modal fade" id="treemodal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
  aria-labelledby="treemodalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="treemodalLabel">Wow! You planted Tree(s)</h5>
      </div>
      <div class="modal-body">
        If you are using deep focus mode then press 'enter'
      </div>
      <div class="modal-footer">
        <button class="btn btn-success" id="treemodalsubmit" onclick="document.getrange.submit()">Ok</button>
      </div>
    </div>
  </div>
</div>


{% if loginuser.in_session %}
<div id="session_end" class="d-none">{{loginuser.session_end_time|date:"M d, Y H:i:s"}}</div>
<div id="session_duration" class="d-none">{{loginuser.session_end}}</div>
<div id="audiosource" class="d-none">{% static 'main/b15.mp3' %}</div>
{% endif %}


{% endblock body %}



{% block script %}



<script>


  session_minutes = 30;
  session_seconds = "00";
  function checkr() {
    val = document.getElementById('range').value
    if (val == 1) {
      session_minutes = 30;
      session_seconds = "00";
      document.getElementById('minutes').innerHTML = session_minutes
      document.getElementById('treesinfo').innerHTML = "Plants 1 tree if you fail you kill a tree"
      document.getElementById('coinsinfo').innerHTML = `<div>Success: +25 coins</div><div>Failure: -20 coins</div>`
    }
    else if (val == 2) {
      session_minutes = 60;
      session_seconds = "00";
      document.getElementById('minutes').innerHTML = session_minutes
      document.getElementById('treesinfo').innerHTML = "Plants 2 trees if you fail you kill two trees"
      document.getElementById('coinsinfo').innerHTML = `<div>Success: +50 coins</div><div>Failure: -40 coins</div>`
    }
    else if (val == 3) {
      session_minutes = 90;
      session_seconds = "00";
      document.getElementById('minutes').innerHTML = session_minutes
      document.getElementById('treesinfo').innerHTML = "Plants 3 trees if you fail you kill three trees"
      document.getElementById('coinsinfo').innerHTML = `<div>Success: +75 coins</div><div>Failure: -60 coins</div>`
    }
    else if (val == 4) {
      session_minutes = 120;
      session_seconds = "00";
      document.getElementById('minutes').innerHTML = session_minutes
      document.getElementById('treesinfo').innerHTML = "Plants 4 trees if you fail you kill four trees"
      document.getElementById('coinsinfo').innerHTML = `<div>Success: +100 coins</div><div>Failure: -80 coins</div>`
    }
    else if (val == 5) {
      session_minutes = 150;
      session_seconds = "00";
      document.getElementById('minutes').innerHTML = session_minutes
      document.getElementById('treesinfo').innerHTML = "Plants 5 trees if you fail you kill five trees"
      document.getElementById('coinsinfo').innerHTML = `<div>Success: +125 coins</div><div>Failure: -100 coins</div>`
    }
    else {
      session_minutes = 180;
      session_seconds = "00";
      document.getElementById('minutes').innerHTML = session_minutes
      document.getElementById('treesinfo').innerHTML = "Plants 6 trees if you fail you kill six trees"
      document.getElementById('coinsinfo').innerHTML = `<div>Success: +150 coins</div><div>Failure: -120 coins</div>`
    }
  }
</script>

{% if loginuser.in_session %}
<script src="{% static 'main/script.js' %}"></script>
{% endif %}
{% endblock script %}