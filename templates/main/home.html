{% extends 'base.html' %}

{% block title %}Home{% endblock title %}

{% block homeactive %}active{% endblock homeactive %}

{% block body %}
<style>
  .show_message {
    display: block;
  }

  #timer {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    border: 10px solid #ffc107;
  }

  input[type="range"]::-ms-thumb {
    background: #ffc107 !important;
  }

  input[type="range"]::-moz-range-thumb {
    background: #ffc107 !important;
  }

  input[type="range"]::-webkit-slider-thumb {
    background: #ffc107 !important;
  }

  .yellow-text-timer {
    color: #ffc107;
  }
  @media only screen and (max-width: 414px) {
    #demotime {
      font-size: 14px;
    }
  }
  @media only screen and (max-width: 375px) {
    #demotime {
      font-size: 12px;
    }
  }
</style>
<!-- Main Timer -->


<div class="container px-5 d-flex justify-content-center align-items-center flex-column"
  style="height: calc(100vh - 60px);">

  <strong id="demotime">30m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;180m</strong>
  <form action="/" method="post" name="getrange">
    {% csrf_token %}
    <input type="range" value=1 onclick="checkr()" onchange="checkr()" id="range" style="width: 300px !important;" name="range" class="form-range" width="200px" min="1" max="6" id="customRange">
    <input type="hidden" name="hidden" id="hidden" value=0>
  </form>


  <div class="card my-4 bg-warning" style="width: 24rem;">
    <ul class="list-group list-group-flush">
      <li class="list-group-item bg-warning text-center" id="treesinfo">plants 1 tree if fails 1 tree is died</li>
      <li class="list-group-item bg-warning text-center" id="coinsinfo">gives 25 coins if fails 20 coins subtracted</li>
    </ul>
  </div>


  <div class="d-flex justify-content-center align-items-center" id=timer>
    <h4 id="minutes" class="display-4">30</h4>
    <h4 id="separator" class="display-4">:</h4>
    <h4 id="seconds" class="display-4">00</h4>
  </div>

  <div class="form-check form-switch mt-2">
    <input class="form-check-input bg-warning" onclick="checkdf()" type="checkbox" id="deepfocus" checked>
    <strong class="form-check-label" for="deepfocus">
      Deep Focus
    </strong>
  </div>
  <span id="dfwarn" class="text-center">(You will enter full screen mode and keyboard and mouse will be locked)<br>HIT
    'space' to Give Up<br>
    <span id="cancelinfo">HIT 'backspace' to Cancel</span></span>


  {% if loginuser %}
  <button class="btn btn-warning mt-2" id="startbtn" onclick="start_timer()">
    start
  </button>
  <button class="btn btn-warning d-none mt-2" data-bs-toggle="modal" data-bs-target="#diedtreemodal" id="giveupbtn">
    Giveup
  </button>
  <button class="btn btn-secondary d-none mt-2" onclick="window.location.reload()" id="cancelbtn">
    Cancel (9)
  </button>
  {% else %}
  <strong>Please Login to continue</strong>
  {% endif %}
  <!-- Finished Message -->
</div>
<!-- Button trigger modal -->
<button type="button" class="btn btn-primary d-none" id="btn_died_tree" data-bs-toggle="modal"
  data-bs-target="#exampleModal">
  Launch demo modal
</button>

<!-- Modal -->
<div class="modal fade" id="diedtreemodal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="diedtreemodalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="diedtreemodalLabel">Your Tree(s) Will Die</h5>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-success" onclick="giveup()">Ok</button>
      </div>
    </div>
  </div>
</div>
<button class="btn btn-warning d-none mt-2" data-bs-toggle="modal" data-bs-target="#treemodal" id="treemodalbtn">
</button>
<div class="modal fade" id="treemodal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="treemodalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="treemodalLabel">Wow! You planted Tree(s)</h5>
      </div>
      <div class="modal-body">
        If you are using deep focus mode then press 'enter'
      </div>
      <div class="modal-footer">
        <button class="btn btn-success" id="treemodalsubmit" onclick="document.getrange.submit()">Ok</button>
      </div>
    </div>
  </div>
</div>
<script>
  function checkdf() {
    val = document.getElementById('deepfocus').checked
    console.log(val)
    if (val == true) {
      document.getElementById("dfwarn").classList.remove('d-none')
    }
    else {
      document.getElementById("dfwarn").classList.add('d-none')
    }
  }
  session_minutes = 30;
  session_seconds = "00";
  function checkr() {
    val = document.getElementById('range').value
    if (val == 1) {
      session_minutes = 30;
      session_seconds = "00";
      document.getElementById('minutes').innerHTML = session_minutes
      document.getElementById('treesinfo').innerHTML = "plants 1 tree if fails 1 tree is died"
      document.getElementById('coinsinfo').innerHTML = "gives 25 coins if fails 20 coins subtracted"
    }
    else if (val == 2) {
      session_minutes = 60;
      session_seconds = "00";
      document.getElementById('minutes').innerHTML = session_minutes
      document.getElementById('treesinfo').innerHTML = "plants 2 trees if fails 2 trees are died"
      document.getElementById('coinsinfo').innerHTML = "gives 50 coins if fails 40 coins subtracted"
    }
    else if (val == 3) {
      session_minutes = 90;
      session_seconds = "00";
      document.getElementById('minutes').innerHTML = session_minutes
      document.getElementById('treesinfo').innerHTML = "plants 3 trees if fails 3 trees are died"
      document.getElementById('coinsinfo').innerHTML = "gives 75 coins if fails 60 coins subtracted"
    }
    else if (val == 4) {
      session_minutes = 120;
      session_seconds = "00";
      document.getElementById('minutes').innerHTML = session_minutes
      document.getElementById('treesinfo').innerHTML = "plants 4 trees if fails 4 trees are died"
      document.getElementById('coinsinfo').innerHTML = "gives 100 coins if fails 80 coins subtracted"
    }
    else if (val == 5) {
      session_minutes = 150;
      session_seconds = "00";
      document.getElementById('minutes').innerHTML = session_minutes
      document.getElementById('treesinfo').innerHTML = "plants 5 trees if fails 5 trees are died"
      document.getElementById('coinsinfo').innerHTML = "gives 125 coins if fails 100 coins subtracted"
    }
    else {
      session_minutes = 180;
      session_seconds = "00";
      document.getElementById('minutes').innerHTML = session_minutes
      document.getElementById('treesinfo').innerHTML = "plants 6 trees if fails 6 trees are died"
      document.getElementById('coinsinfo').innerHTML = "gives 150 coins if fails 120 coins subtracted"
    }
  }

  document.addEventListener('DOMContentLoaded', function template() {
    document.getElementById("minutes").innerHTML = session_minutes;
    document.getElementById("seconds").innerHTML = session_seconds;
  });

  function giveup() {
    document.getElementById('hidden').value = -1
    document.getrange.submit()
    document.getElementById('startbtn').classList.remove('d-none')
    document.getElementById('giveupbtn').classList.add('d-none')
  }
  function start_timer() {
    document.getElementById('range').classList.add('d-none')
    document.getElementById('demotime').classList.add('d-none')
    document.getElementById('startbtn').classList.add('d-none')
    document.getElementById('cancelbtn').classList.remove('d-none')
    deepfocus = document.getElementById('deepfocus').disabled = true
    // document.getElementById('giveupbtn').classList.remove('d-none')
    document.getElementById('Mynavbar').classList.add('d-none')
    deepfocus = document.getElementById('deepfocus').checked
    if (deepfocus == true) {
      document.documentElement.requestFullscreen().catch((e) => {
        console.log(e);
      });
      navigator.keyboard.lock([
        "Backquote", "Backslash", "BracketLeft", "BracketRight", "Comma", "Digit0", "Digit1", "Digit2", "Digit3", "Digit4", "Digit5", "Digit6", "Digit7", "Digit8", "Digit9", "Equal", "IntlBackslash", "IntlRo", "IntlYen", "KeyA", "KeyB", "KeyC", "KeyD", "KeyE", "KeyF", "KeyG", "KeyH", "KeyI", "KeyJ", "KeyK", "KeyL", "KeyM", "KeyN", "KeyO", "KeyP", "KeyQ", "KeyR", "KeyS", "KeyT", "KeyU", "KeyV", "KeyW", "KeyX", "KeyY", "KeyZ", "Minus", "Period", "Quote", "Semicolon", "Slash", "AltLeft", "AltRight", "CapsLock", "ContextMenu", "ControlLeft", "ControlRight", "MetaLeft", "MetaRight", "ShiftLeft", "ShiftRight", "Tab", "Delete", "Backspace", "End", "Help", "Home", "Insert", "PageDown", "PageUp", "ArrowDown", "ArrowLeft", "ArrowRight", "ArrowUp", "NumLock", "Numpad0", "Numpad1", "Numpad2", "Numpad3", "Numpad4", "Numpad5", "Numpad6", "Numpad7", "Numpad8", "Numpad9", "NumpadAdd", "NumpadBackspace", "NumpadClear", "NumLock", "NumpadClearEntry", "NumpadComma", "NumpadDecimal", "NumpadDivide", "NumpadEnter", "NumpadEqual", "NumpadHash", "NumpadMemoryAdd", "NumpadMemoryClear", "NumpadMemoryRecall", "NumpadMemoryStore", "NumpadMemorySubtract", "NumpadMultiply", "NumpadStar", "NumpadParenLeft", "NumpadParenRight", "NumpadStar", "NumpadMultiply", "NumpadSubtract", "Escape", "F1", "F2", "F3", "F4", "F5", "F6", "F7", "F8", "F9", "F10", "F11", "F12", "Fn", "FnLock", "PrintScreen", "ScrollLock", "Pause", "BrowserBack", "BrowserFavorites", "BrowserForward", "BrowserHome", "BrowserRefresh", "BrowserSearch", "BrowserStop", "Eject", "LaunchApp1", "LaunchApp2", "LaunchMail", "MediaPlayPause", "MediaSelect", "MediaStop", "MediaTrackNext", "MediaTrackPrevious", "Power", "Sleep", "AudioVolumeDown", "AudioVolumeMute", "AudioVolumeUp", "WakeUp"
      ]);
      document.body.requestPointerLock();
    }
    session_minutes = session_minutes - 1;
    session_seconds = 59;
    document.getElementById("minutes").innerHTML = session_minutes;
    document.getElementById("seconds").innerHTML = session_seconds;
    var minutes_interval = setInterval(minutesTimer, 60000);
    var seconds_interval = setInterval(secondsTimer, 1000);
    function minutesTimer() {
      session_minutes = session_minutes - 1;
      if (session_minutes < 10){
        document.getElementById("minutes").innerHTML = "0" + session_minutes;
      }
      else{
        document.getElementById("minutes").innerHTML = session_minutes;
      }
    }
    i = 8
    function secondsTimer() {
      
      if (i == 0) {
        document.getElementById('giveupbtn').classList.remove('d-none')
        document.getElementById('cancelbtn').classList.add('d-none')
        if (deepfocus == true){
          navigator.keyboard.lock(["Backquote","Backspace" "Backslash", "BracketLeft", "BracketRight", "Comma", "Digit0", "Digit1", "Digit2", "Digit3", "Digit4", "Digit5", "Digit6", "Digit7", "Digit8", "Digit9", "Equal", "IntlBackslash", "IntlRo", "IntlYen", "KeyA", "KeyB", "KeyC", "KeyD", "KeyE", "KeyF", "KeyG", "KeyH", "KeyI", "KeyJ", "KeyK", "KeyL", "KeyM", "KeyN", "KeyO", "KeyP", "KeyQ", "KeyR", "KeyS", "KeyT", "KeyU", "KeyV", "KeyW", "KeyX", "KeyY", "KeyZ", "Minus", "Period", "Quote", "Semicolon", "Slash", "AltLeft", "AltRight", "CapsLock", "ContextMenu", "ControlLeft", "ControlRight", "MetaLeft", "MetaRight", "ShiftLeft", "ShiftRight", "Tab", "Delete", "Backspace", "End", "Help", "Home", "Insert", "PageDown", "PageUp", "ArrowDown", "ArrowLeft", "ArrowRight", "ArrowUp", "NumLock", "Numpad0", "Numpad1", "Numpad2", "Numpad3", "Numpad4", "Numpad5", "Numpad6", "Numpad7", "Numpad8", "Numpad9", "NumpadAdd", "NumpadBackspace", "NumpadClear", "NumLock", "NumpadClearEntry", "NumpadComma", "NumpadDecimal", "NumpadDivide", "NumpadEnter", "NumpadEqual", "NumpadHash", "NumpadMemoryAdd", "NumpadMemoryClear", "NumpadMemoryRecall", "NumpadMemoryStore", "NumpadMemorySubtract", "NumpadMultiply", "NumpadStar", "NumpadParenLeft", "NumpadParenRight", "NumpadStar", "NumpadMultiply", "NumpadSubtract", "Escape", "F1", "F2", "F3", "F4", "F5", "F6", "F7", "F8", "F9", "F10", "F11", "F12", "Fn", "FnLock", "PrintScreen", "ScrollLock", "Pause", "BrowserBack", "BrowserFavorites", "BrowserForward", "BrowserHome", "BrowserRefresh", "BrowserSearch", "BrowserStop", "Eject", "LaunchApp1", "LaunchApp2", "LaunchMail", "MediaPlayPause", "MediaSelect", "MediaStop", "MediaTrackNext", "MediaTrackPrevious", "Power", "Sleep", "AudioVolumeDown", "AudioVolumeMute", "AudioVolumeUp", "WakeUp"])
          document.getElementById('cancelinfo').classList.add('d-none')
        }

      }
      document.getElementById('cancelbtn').innerHTML = "Cancel (" + i + ")"
      i -= 1
      session_seconds = session_seconds - 1;
      if (session_seconds < 10){
        document.getElementById("seconds").innerHTML = "0" + session_seconds;
      }
      else{
        document.getElementById("seconds").innerHTML = session_seconds;
      }
      if (session_seconds % 2 == 0) {
        document.getElementById('minutes').classList.add('yellow-text-timer')
        document.getElementById('seconds').classList.add('yellow-text-timer')
        document.getElementById('separator').classList.add('yellow-text-timer')
      }
      else {
        document.getElementById('minutes').classList.remove('yellow-text-timer')
        document.getElementById('seconds').classList.remove('yellow-text-timer')
        document.getElementById('separator').classList.remove('yellow-text-timer')
      }
      if (session_seconds <= 0) {
        if (session_minutes <= 0) {
          clearInterval(minutes_interval);
          clearInterval(seconds_interval);
          document.getElementById('treemodalbtn').click()
        }
        session_seconds = 60;
      }
    }
  }
  document.body.onkeyup = function (e) {
    if (e.keyCode == 32) {
      giveup()
    }
    if (e.keyCode == 13) {
      document.getElementById('treemodalsubmit').click()
    }
    if (e.keyCode == 8) {
      document.getElementById('cancelbtn').click()
    }
  }
  


</script>

{% endblock body %}